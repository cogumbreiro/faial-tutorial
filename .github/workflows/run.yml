on: [push]

jobs:
  check_drf:
    runs-on: ubuntu-latest
    name: Check that saxpy.cu is DRF.
    steps:
    - name: Check out code
      uses: actions/checkout@v1
    - name: Setup faial
      uses: cogumbreiro/setup-faial@v1.0
    - name: Check saxpy.cu
      run: |
        faial-drf saxpy.cu
    - name: Check saxpy-buggy.cu
      run: |
        ! faial-drf saxpy-buggy.cu
    - name: Grid level analysis (2048 blocks)
      run: |
        ! faial-drf --grid-dim 2048 --grid-level racy-grid-level.cu
    - name: Block level analysis (2048 blocks)
      run: |
        faial-drf --grid-dim 2048 racy-grid-level.cu